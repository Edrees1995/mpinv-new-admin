<!-- Breadcrumb -->
<nav class="mb-6">
    <ol class="flex items-center space-x-2 text-sm">
        <li>
            <a href="/" class="text-gray-500 hover:text-gray-700">Dashboard</a>
        </li>
        <li class="text-gray-400">/</li>
        <li>
            <a href="/projects" class="text-gray-500 hover:text-gray-700">Projects</a>
        </li>
        <li class="text-gray-400">/</li>
        <li>
            <a href="/projects/{{project.id}}" class="text-gray-500 hover:text-gray-700">{{project.name}}</a>
        </li>
        <li class="text-gray-400">/</li>
        <li class="text-gray-900 font-medium">Edit</li>
    </ol>
</nav>

<!-- Page Header -->
<div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
        <h1 class="text-2xl font-bold text-gray-900">Edit Project</h1>
        <p class="mt-1 text-sm text-gray-500">Update project information</p>
    </div>
    <div class="flex items-center gap-3">
        <a href="/projects/{{project.id}}" class="inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
            </svg>
            View
        </a>
        <a href="/projects" class="inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Back to List
        </a>
    </div>
</div>

<!-- Alert Container for HTMX responses -->
<div id="alert-container"></div>

<!-- Form -->
<form
    hx-put="/projects/{{project.id}}"
    hx-target="#alert-container"
    hx-swap="innerHTML"
    class="space-y-6"
>
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Basic Information -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Basic Information</h2>
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">
                                Project Name <span class="text-red-500">*</span>
                            </label>
                            <input
                                type="text"
                                id="name"
                                name="name"
                                value="{{project.name}}"
                                required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                placeholder="Enter project name"
                            >
                        </div>
                        <div>
                            <label for="slug" class="block text-sm font-medium text-gray-700 mb-1">
                                Slug
                            </label>
                            <input
                                type="text"
                                id="slug"
                                name="slug"
                                value="{{project.slug}}"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                placeholder="project-url-slug"
                            >
                        </div>
                    </div>
                    <div>
                        <label for="short_description" class="block text-sm font-medium text-gray-700 mb-1">
                            Short Description
                        </label>
                        <textarea
                            id="short_description"
                            name="short_description"
                            rows="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="Brief summary of the project"
                        >{{project.short_description}}</textarea>
                    </div>
                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700 mb-1">
                            Full Description
                        </label>
                        <textarea
                            id="description"
                            name="description"
                            rows="6"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="Enter full project description"
                        >{{project.description}}</textarea>
                    </div>
                </div>
            </div>

            <!-- Property Details -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Property Details</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div>
                        <label for="price" class="block text-sm font-medium text-gray-700 mb-1">
                            Starting Price (AED)
                        </label>
                        <input
                            type="number"
                            id="price"
                            name="price"
                            value="{{project.price}}"
                            step="0.01"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="0.00"
                        >
                    </div>
                    <div>
                        <label for="bedrooms" class="block text-sm font-medium text-gray-700 mb-1">
                            Bedrooms
                        </label>
                        <input
                            type="text"
                            id="bedrooms"
                            name="bedrooms"
                            value="{{project.bedrooms}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="e.g., 1-4"
                        >
                    </div>
                    <div>
                        <label for="bathrooms" class="block text-sm font-medium text-gray-700 mb-1">
                            Bathrooms
                        </label>
                        <input
                            type="text"
                            id="bathrooms"
                            name="bathrooms"
                            value="{{project.bathrooms}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="e.g., 1-3"
                        >
                    </div>
                    <div>
                        <label for="no_of_units" class="block text-sm font-medium text-gray-700 mb-1">
                            Number of Units
                        </label>
                        <input
                            type="text"
                            id="no_of_units"
                            name="no_of_units"
                            value="{{project.no_of_units}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="e.g., 500"
                        >
                    </div>
                    <div>
                        <label for="size" class="block text-sm font-medium text-gray-700 mb-1">
                            Size (sq.ft)
                        </label>
                        <input
                            type="text"
                            id="size"
                            name="size"
                            value="{{project.size}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="e.g., 500-2000"
                        >
                    </div>
                    <div>
                        <label for="plot_size" class="block text-sm font-medium text-gray-700 mb-1">
                            Plot Size (sq.ft)
                        </label>
                        <input
                            type="text"
                            id="plot_size"
                            name="plot_size"
                            value="{{project.plot_size}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="For villas/townhouses"
                        >
                    </div>
                    <div>
                        <label for="completion_year" class="block text-sm font-medium text-gray-700 mb-1">
                            Completion Year
                        </label>
                        <input
                            type="text"
                            id="completion_year"
                            name="completion_year"
                            value="{{project.completion_year}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="e.g., 2025"
                        >
                    </div>
                    <div>
                        <label for="handover_date" class="block text-sm font-medium text-gray-700 mb-1">
                            Handover Date
                        </label>
                        <input
                            type="date"
                            id="handover_date"
                            name="handover_date"
                            value="{{project.handover_date}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                        >
                    </div>
                </div>
            </div>

            <!-- Location -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Location</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="community_id" class="block text-sm font-medium text-gray-700 mb-1">
                            Community
                        </label>
                        <select
                            id="community_id"
                            name="community_id"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                        >
                            <option value="">Select Community</option>
                            {{#each communities}}
                            <option value="{{this.community_id}}" {{#if (eq this.community_id ../project.community_id)}}selected{{/if}}>{{this.name}}</option>
                            {{/each}}
                        </select>
                    </div>
                    <div>
                        <label for="property_name" class="block text-sm font-medium text-gray-700 mb-1">
                            Property/Building Name
                        </label>
                        <input
                            type="text"
                            id="property_name"
                            name="property_name"
                            value="{{project.property_name}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="Building or property name"
                        >
                    </div>
                    <div>
                        <label for="latitude" class="block text-sm font-medium text-gray-700 mb-1">
                            Latitude
                        </label>
                        <input
                            type="text"
                            id="latitude"
                            name="latitude"
                            value="{{project.latitude}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="e.g., 24.4539"
                        >
                    </div>
                    <div>
                        <label for="longitude" class="block text-sm font-medium text-gray-700 mb-1">
                            Longitude
                        </label>
                        <input
                            type="text"
                            id="longitude"
                            name="longitude"
                            value="{{project.longitude}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="e.g., 54.3773"
                        >
                    </div>
                </div>
            </div>

            <!-- Images & Media -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Images & Media</h2>
                <div class="space-y-4">
                    <div>
                        <label for="featured_image" class="block text-sm font-medium text-gray-700 mb-1">
                            Featured Image URL
                        </label>
                        <input
                            type="text"
                            id="featured_image"
                            name="featured_image"
                            value="{{project.featured_image}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="https://example.com/image.jpg"
                        >
                        {{#if project.featured_image}}
                        <div id="image-preview" class="mt-4">
                            <img src="{{project.featured_image}}" alt="{{project.name}}" class="max-w-full h-48 object-cover rounded-lg">
                        </div>
                        {{/if}}
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="youtube_url" class="block text-sm font-medium text-gray-700 mb-1">
                                YouTube URL
                            </label>
                            <input
                                type="url"
                                id="youtube_url"
                                name="youtube_url"
                                value="{{project.youtube_url}}"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                placeholder="https://youtube.com/watch?v=..."
                            >
                        </div>
                        <div>
                            <label for="video_link" class="block text-sm font-medium text-gray-700 mb-1">
                                Video Link
                            </label>
                            <input
                                type="url"
                                id="video_link"
                                name="video_link"
                                value="{{project.video_link}}"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                placeholder="https://vimeo.com/..."
                            >
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gallery Images -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">
                    Gallery Images
                    {{#if project.images}}
                    <span class="text-sm font-normal text-gray-500">({{project.images.length}} images)</span>
                    {{/if}}
                </h2>
                {{#if project.images.length}}
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    {{#each project.images}}
                    <div class="relative group">
                        <img
                            src="{{this.image_name}}"
                            alt="Gallery image"
                            class="w-full h-32 object-cover rounded-lg border border-gray-200"
                            onerror="this.onerror=null; this.src='https://placehold.co/300x200/eee/999?text=No+Image';"
                        >
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all rounded-lg flex items-center justify-center">
                            <a
                                href="{{this.image_name}}"
                                target="_blank"
                                class="opacity-0 group-hover:opacity-100 bg-white text-gray-700 px-3 py-1 rounded text-sm transition-opacity"
                            >
                                View
                            </a>
                        </div>
                    </div>
                    {{/each}}
                </div>
                <p class="mt-4 text-sm text-gray-500">
                    Gallery images are managed through the image upload system. Use the old admin panel to add/remove gallery images.
                </p>
                {{else}}
                <div class="text-center py-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200">
                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <p class="mt-2 text-sm text-gray-500">No gallery images uploaded</p>
                    <p class="mt-1 text-xs text-gray-400">Use the old admin panel to upload images</p>
                </div>
                {{/if}}
            </div>

            <!-- Property Types / Unit Types -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">
                        Property Types
                        {{#if project.propertyTypes}}
                        <span class="text-sm font-normal text-gray-500">({{project.propertyTypes.length}} types)</span>
                        {{/if}}
                    </h2>
                    <button
                        type="button"
                        onclick="addPropertyType()"
                        class="inline-flex items-center px-3 py-1.5 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                    >
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Add Type
                    </button>
                </div>
                <div id="property-types-container" class="space-y-4">
                    {{#each project.propertyTypes}}
                    <div class="property-type-item border border-gray-200 rounded-lg p-4 bg-gray-50" data-id="{{this.id}}">
                        <div class="flex items-start gap-4">
                            <!-- Images Column -->
                            <div class="flex flex-col gap-2 w-32 flex-shrink-0">
                                <!-- Property Type Image -->
                                <div class="relative group">
                                    <label class="block text-xs text-gray-500 mb-1">Image</label>
                                    <div class="relative">
                                        {{#if this.image}}
                                        <img
                                            src="{{this.image}}"
                                            alt="{{this.title}}"
                                            class="w-full h-20 object-cover rounded border border-gray-200 property-type-image-preview"
                                            onerror="this.onerror=null; this.src='https://placehold.co/100x80/eee/999?text=No+Image';"
                                        >
                                        {{else}}
                                        <div class="w-full h-20 bg-gray-200 rounded flex items-center justify-center property-type-image-preview">
                                            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                            </svg>
                                        </div>
                                        {{/if}}
                                        <input type="file" accept="image/*" class="hidden property-type-image-file" data-type="image" data-id="{{this.id}}" onchange="uploadPropertyTypeImage(this)">
                                        <button type="button" onclick="this.previousElementSibling.click()" class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-0 hover:bg-opacity-50 transition-all rounded">
                                            <span class="text-white opacity-0 hover:opacity-100 text-xs font-medium">
                                                <svg class="w-5 h-5 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                                </svg>
                                                Upload
                                            </span>
                                        </button>
                                    </div>
                                </div>
                                <!-- Floor Plan -->
                                <div class="relative group">
                                    <label class="block text-xs text-gray-500 mb-1">Floor Plan</label>
                                    <div class="relative">
                                        {{#if this.floor_plan}}
                                        <img
                                            src="{{this.floor_plan}}"
                                            alt="Floor Plan"
                                            class="w-full h-20 object-contain rounded border border-gray-200 bg-white property-type-floorplan-preview"
                                            onerror="this.onerror=null; this.src='https://placehold.co/100x80/eee/999?text=No+Plan';"
                                        >
                                        {{else}}
                                        <div class="w-full h-20 bg-gray-200 rounded flex items-center justify-center property-type-floorplan-preview">
                                            <span class="text-xs text-gray-400">No Plan</span>
                                        </div>
                                        {{/if}}
                                        <input type="file" accept="image/*,.pdf" class="hidden property-type-floorplan-file" data-type="floor_plan" data-id="{{this.id}}" onchange="uploadPropertyTypeImage(this)">
                                        <button type="button" onclick="this.previousElementSibling.click()" class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-0 hover:bg-opacity-50 transition-all rounded">
                                            <span class="text-white opacity-0 hover:opacity-100 text-xs font-medium">
                                                <svg class="w-5 h-5 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                                </svg>
                                                Upload
                                            </span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!-- Form Fields -->
                            <div class="flex-grow">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                    <div class="md:col-span-2 lg:col-span-3">
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Title</label>
                                        <input
                                            type="text"
                                            name="propertyTypes[{{@index}}][title]"
                                            value="{{this.title}}"
                                            class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                            placeholder="e.g., 1-Bedroom Apartment"
                                        >
                                        <input type="hidden" name="propertyTypes[{{@index}}][id]" value="{{this.id}}">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Beds</label>
                                        <input
                                            type="number"
                                            name="propertyTypes[{{@index}}][bed]"
                                            value="{{this.bed}}"
                                            min="0"
                                            class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                        >
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Baths</label>
                                        <input
                                            type="number"
                                            name="propertyTypes[{{@index}}][bath]"
                                            value="{{this.bath}}"
                                            min="0"
                                            class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                        >
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Size From (sq.ft)</label>
                                        <input
                                            type="number"
                                            name="propertyTypes[{{@index}}][size]"
                                            value="{{this.size}}"
                                            step="0.01"
                                            class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                        >
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Size To (sq.ft)</label>
                                        <input
                                            type="number"
                                            name="propertyTypes[{{@index}}][size_to]"
                                            value="{{this.size_to}}"
                                            step="0.01"
                                            class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                        >
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Price From (AED)</label>
                                        <input
                                            type="number"
                                            name="propertyTypes[{{@index}}][from_price]"
                                            value="{{this.from_price}}"
                                            step="0.01"
                                            class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                        >
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Price To (AED)</label>
                                        <input
                                            type="number"
                                            name="propertyTypes[{{@index}}][to_price]"
                                            value="{{this.to_price}}"
                                            step="0.01"
                                            class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                        >
                                    </div>
                                    <div class="md:col-span-2 lg:col-span-3">
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Description</label>
                                        <input
                                            type="text"
                                            name="propertyTypes[{{@index}}][description]"
                                            value="{{this.description}}"
                                            class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                            placeholder="Optional description"
                                        >
                                    </div>
                                    <div class="lg:col-span-2">
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Image Filename</label>
                                        <input
                                            type="text"
                                            name="propertyTypes[{{@index}}][image]"
                                            value="{{this.image}}"
                                            class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 property-type-image-input"
                                            placeholder="image.jpg"
                                        >
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Floor Plan Filename</label>
                                        <input
                                            type="text"
                                            name="propertyTypes[{{@index}}][floor_plan]"
                                            value="{{this.floor_plan}}"
                                            class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 property-type-floorplan-input"
                                            placeholder="floorplan.jpg"
                                        >
                                    </div>
                                </div>
                            </div>
                            <!-- Delete Button -->
                            <div class="flex-shrink-0">
                                <button
                                    type="button"
                                    onclick="deletePropertyType(this, {{this.id}})"
                                    class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                                    title="Delete this property type"
                                >
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    {{/each}}
                </div>
                {{#unless project.propertyTypes.length}}
                <div id="no-property-types" class="text-center py-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200">
                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                    </svg>
                    <p class="mt-2 text-sm text-gray-500">No property types defined</p>
                    <p class="mt-1 text-xs text-gray-400">Click "Add Type" to create property types</p>
                </div>
                {{/unless}}
            </div>

            <!-- Floor Plans (Separate Files) -->
            {{#if project.floorPlans.length}}
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">
                    Floor Plan Files
                    <span class="text-sm font-normal text-gray-500">({{project.floorPlans.length}} files)</span>
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    {{#each project.floorPlans}}
                    <a href="{{this.floor_file}}" target="_blank" class="block border border-gray-200 rounded-lg p-3 hover:bg-gray-50">
                        <img
                            src="{{this.floor_file}}"
                            alt="{{this.floor_title}}"
                            class="w-full h-32 object-contain bg-white rounded"
                            onerror="this.onerror=null; this.src='https://placehold.co/200x150/eee/999?text=Floor+Plan';"
                        >
                        <p class="mt-2 text-sm text-gray-700 text-center truncate">{{this.floor_title}}</p>
                    </a>
                    {{/each}}
                </div>
            </div>
            {{/if}}

            <!-- Payment Plans -->
            {{#if project.paymentPlans.length}}
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">
                    Payment Plans
                    <span class="text-sm font-normal text-gray-500">({{project.paymentPlans.length}} plans)</span>
                </h2>
                <div class="space-y-3">
                    {{#each project.paymentPlans}}
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="font-medium text-gray-900">{{this.title}}</h4>
                        {{#if this.description}}
                        <p class="mt-1 text-sm text-gray-600">{{this.description}}</p>
                        {{/if}}
                    </div>
                    {{/each}}
                </div>
            </div>
            {{/if}}

            <!-- Documents -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Documents</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="floor_pdf" class="block text-sm font-medium text-gray-700 mb-1">
                            Floor Plan PDF
                        </label>
                        <input
                            type="text"
                            id="floor_pdf"
                            name="floor_pdf"
                            value="{{project.floor_pdf}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="URL or filename"
                        >
                    </div>
                    <div>
                        <label for="payment_pdf" class="block text-sm font-medium text-gray-700 mb-1">
                            Payment Plan PDF
                        </label>
                        <input
                            type="text"
                            id="payment_pdf"
                            name="payment_pdf"
                            value="{{project.payment_pdf}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="URL or filename"
                        >
                    </div>
                    <div>
                        <label for="brochure" class="block text-sm font-medium text-gray-700 mb-1">
                            Brochure PDF
                        </label>
                        <input
                            type="text"
                            id="brochure"
                            name="brochure"
                            value="{{project.brochure}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="URL or filename"
                        >
                    </div>
                    <div>
                        <label for="brochure_link" class="block text-sm font-medium text-gray-700 mb-1">
                            Online Brochure Link
                        </label>
                        <input
                            type="url"
                            id="brochure_link"
                            name="brochure_link"
                            value="{{project.brochure_link}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="https://..."
                        >
                    </div>
                </div>
            </div>

            <!-- Developer Info -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Developer Information</h2>
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="developer_id" class="block text-sm font-medium text-gray-700 mb-1">
                                Developer (from database)
                            </label>
                            <select
                                id="developer_id"
                                name="developer_id"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            >
                                <option value="">Select Developer</option>
                                {{#each developers}}
                                <option value="{{this.id}}" {{#if (eq this.id ../project.developer_id)}}selected{{/if}}>{{this.name}}</option>
                                {{/each}}
                            </select>
                        </div>
                        <div>
                            <label for="developer_name" class="block text-sm font-medium text-gray-700 mb-1">
                                Developer Name (override)
                            </label>
                            <input
                                type="text"
                                id="developer_name"
                                name="developer_name"
                                value="{{project.developer_name}}"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                placeholder="Custom developer name"
                            >
                        </div>
                    </div>
                    <div>
                        <label for="developer_logo" class="block text-sm font-medium text-gray-700 mb-1">
                            Developer Logo URL
                        </label>
                        <input
                            type="text"
                            id="developer_logo"
                            name="developer_logo"
                            value="{{project.developer_logo}}"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="URL or filename"
                        >
                        {{#if project.developer_logo}}
                        <div class="mt-2">
                            <img src="{{project.developer_logo}}" alt="Developer Logo" class="h-12 object-contain">
                        </div>
                        {{/if}}
                    </div>
                    <div>
                        <label for="developer_description" class="block text-sm font-medium text-gray-700 mb-1">
                            Developer Description
                        </label>
                        <textarea
                            id="developer_description"
                            name="developer_description"
                            rows="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="About the developer"
                        >{{project.developer_description}}</textarea>
                    </div>
                </div>
            </div>

            <!-- Highlights -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Project Highlights</h2>
                <div>
                    <label for="highlights" class="block text-sm font-medium text-gray-700 mb-1">
                        Highlights (JSON)
                    </label>
                    <textarea
                        id="highlights"
                        name="highlights"
                        rows="4"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 font-mono text-sm"
                        placeholder='["Feature 1", "Feature 2", "Feature 3"]'
                    >{{project.highlights}}</textarea>
                    <p class="mt-1 text-xs text-gray-500">Enter as JSON array or object</p>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Publish Settings -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Publish Settings</h2>
                <div class="space-y-4">
                    <div>
                        <label for="status" class="block text-sm font-medium text-gray-700 mb-1">
                            Status <span class="text-red-500">*</span>
                        </label>
                        <select
                            id="status"
                            name="status"
                            required
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                        >
                            <option value="A" {{#if (eq project.status "A")}}selected{{/if}}>Active</option>
                            <option value="I" {{#if (eq project.status "I")}}selected{{/if}}>Inactive</option>
                        </select>
                    </div>
                    <div>
                        <label for="featured" class="block text-sm font-medium text-gray-700 mb-1">
                            Featured
                        </label>
                        <select
                            id="featured"
                            name="featured"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                        >
                            <option value="N" {{#if (eq project.featured "N")}}selected{{/if}}>No</option>
                            <option value="Y" {{#if (eq project.featured "Y")}}selected{{/if}}>Yes</option>
                        </select>
                    </div>
                    <div>
                        <label for="project_status" class="block text-sm font-medium text-gray-700 mb-1">
                            Project Status
                        </label>
                        <select
                            id="project_status"
                            name="project_status"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                        >
                            <option value="">Select Status</option>
                            <option value="Off Plan" {{#if (eq project.project_status "Off Plan")}}selected{{/if}}>Off Plan</option>
                            <option value="Under Construction" {{#if (eq project.project_status "Under Construction")}}selected{{/if}}>Under Construction</option>
                            <option value="Ready" {{#if (eq project.project_status "Ready")}}selected{{/if}}>Ready</option>
                            <option value="Completed" {{#if (eq project.project_status "Completed")}}selected{{/if}}>Completed</option>
                        </select>
                    </div>
                </div>
                <div class="mt-6 pt-4 border-t border-gray-200 space-y-3">
                    <button
                        type="submit"
                        class="w-full flex items-center justify-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                    >
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        Update Project
                    </button>
                    <button
                        type="button"
                        hx-delete="/projects/{{project.id}}"
                        hx-confirm="Are you sure you want to delete this project?"
                        class="w-full flex items-center justify-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                    >
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                        Delete Project
                    </button>
                </div>
            </div>

            <!-- Project Info -->
            <div class="bg-gray-50 rounded-lg border border-gray-200 p-4">
                <h3 class="text-sm font-medium text-gray-700 mb-3">Project Info</h3>
                <dl class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <dt class="text-gray-500">ID:</dt>
                        <dd class="text-gray-900">#{{project.id}}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-gray-500">Slug:</dt>
                        <dd class="text-gray-900 truncate max-w-[150px]">{{project.slug}}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-gray-500">Created:</dt>
                        <dd class="text-gray-900">{{#if project.created_at}}{{formatDate project.created_at}}{{else}}N/A{{/if}}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-gray-500">Updated:</dt>
                        <dd class="text-gray-900">{{#if project.updated_at}}{{formatDate project.updated_at}}{{else}}N/A{{/if}}</dd>
                    </div>
                </dl>
            </div>

            <!-- Data Status -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-4">
                <h3 class="text-sm font-medium text-gray-700 mb-3">Data Completeness</h3>
                <ul class="space-y-2 text-sm">
                    <li class="flex items-center">
                        {{#if project.featured_image}}
                        <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        {{else}}
                        <svg class="w-4 h-4 text-red-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                        {{/if}}
                        <span class="{{#unless project.featured_image}}text-red-600{{/unless}}">Featured Image</span>
                    </li>
                    <li class="flex items-center">
                        {{#if project.images.length}}
                        <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        {{else}}
                        <svg class="w-4 h-4 text-yellow-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
                        {{/if}}
                        <span class="{{#unless project.images.length}}text-yellow-600{{/unless}}">Gallery ({{project.images.length}})</span>
                    </li>
                    <li class="flex items-center">
                        {{#if project.propertyTypes.length}}
                        <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        {{else}}
                        <svg class="w-4 h-4 text-yellow-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
                        {{/if}}
                        <span class="{{#unless project.propertyTypes.length}}text-yellow-600{{/unless}}">Property Types ({{project.propertyTypes.length}})</span>
                    </li>
                    <li class="flex items-center">
                        {{#if project.description}}
                        <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        {{else}}
                        <svg class="w-4 h-4 text-red-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                        {{/if}}
                        <span class="{{#unless project.description}}text-red-600{{/unless}}">Description</span>
                    </li>
                    <li class="flex items-center">
                        {{#if project.price}}
                        <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        {{else}}
                        <svg class="w-4 h-4 text-yellow-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
                        {{/if}}
                        <span class="{{#unless project.price}}text-yellow-600{{/unless}}">Price</span>
                    </li>
                    <li class="flex items-center">
                        {{#if (or project.latitude project.longitude)}}
                        <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        {{else}}
                        <svg class="w-4 h-4 text-yellow-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
                        {{/if}}
                        <span class="{{#unless (or project.latitude project.longitude)}}text-yellow-600{{/unless}}">Location</span>
                    </li>
                    <li class="flex items-center">
                        {{#if (or project.developer_id project.developer_name)}}
                        <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        {{else}}
                        <svg class="w-4 h-4 text-yellow-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
                        {{/if}}
                        <span class="{{#unless (or project.developer_id project.developer_name)}}text-yellow-600{{/unless}}">Developer</span>
                    </li>
                </ul>
            </div>

            <!-- Help -->
            <div class="bg-blue-50 rounded-lg border border-blue-100 p-4">
                <h3 class="text-sm font-medium text-blue-800 mb-2">Tips</h3>
                <ul class="text-sm text-blue-700 space-y-1">
                    <li>- Green checkmarks = data complete</li>
                    <li>- Red X = required data missing</li>
                    <li>- Yellow = optional but recommended</li>
                </ul>
            </div>
        </div>
    </div>
</form>

<script>
    // Image preview functionality
    document.getElementById('featured_image')?.addEventListener('input', function(e) {
        const url = e.target.value;
        const preview = document.getElementById('image-preview');
        if (preview) {
            const img = preview.querySelector('img');
            if (url) {
                img.src = url;
                img.onload = function() {
                    preview.classList.remove('hidden');
                };
                img.onerror = function() {
                    preview.classList.add('hidden');
                };
            } else {
                preview.classList.add('hidden');
            }
        }
    });

    // Property Types Management
    let propertyTypeIndex = {{#if project.propertyTypes}}{{project.propertyTypes.length}}{{else}}0{{/if}};
    const IMAGE_BASE_URL = 'https://admin.mpinv.cloud/uploads/ads/';

    function addPropertyType() {
        const container = document.getElementById('property-types-container');
        const noTypesMsg = document.getElementById('no-property-types');
        if (noTypesMsg) noTypesMsg.style.display = 'none';

        const newItem = document.createElement('div');
        newItem.className = 'property-type-item border border-gray-200 rounded-lg p-4 bg-green-50';
        newItem.dataset.id = 'new';
        newItem.innerHTML = `
            <div class="flex items-start gap-4">
                <div class="flex flex-col gap-2 w-28 flex-shrink-0">
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">Image</label>
                        <div class="w-full h-20 bg-gray-200 rounded flex items-center justify-center property-type-image-preview">
                            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">Floor Plan</label>
                        <div class="w-full h-20 bg-gray-200 rounded flex items-center justify-center property-type-floorplan-preview">
                            <span class="text-xs text-gray-400">No Plan</span>
                        </div>
                    </div>
                </div>
                <div class="flex-grow">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                        <div class="md:col-span-2 lg:col-span-3">
                            <label class="block text-xs font-medium text-gray-700 mb-1">Title</label>
                            <input type="text" name="propertyTypes[${propertyTypeIndex}][title]" class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="e.g., 1-Bedroom Apartment">
                            <input type="hidden" name="propertyTypes[${propertyTypeIndex}][id]" value="">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Beds</label>
                            <input type="number" name="propertyTypes[${propertyTypeIndex}][bed]" value="1" min="0" class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Baths</label>
                            <input type="number" name="propertyTypes[${propertyTypeIndex}][bath]" value="1" min="0" class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Size From (sq.ft)</label>
                            <input type="number" name="propertyTypes[${propertyTypeIndex}][size]" step="0.01" class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Size To (sq.ft)</label>
                            <input type="number" name="propertyTypes[${propertyTypeIndex}][size_to]" step="0.01" class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Price From (AED)</label>
                            <input type="number" name="propertyTypes[${propertyTypeIndex}][from_price]" step="0.01" class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Price To (AED)</label>
                            <input type="number" name="propertyTypes[${propertyTypeIndex}][to_price]" step="0.01" class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                        </div>
                        <div class="md:col-span-2 lg:col-span-3">
                            <label class="block text-xs font-medium text-gray-700 mb-1">Description</label>
                            <input type="text" name="propertyTypes[${propertyTypeIndex}][description]" class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="Optional description">
                        </div>
                        <div class="lg:col-span-2">
                            <label class="block text-xs font-medium text-gray-700 mb-1">Image Filename</label>
                            <input type="text" name="propertyTypes[${propertyTypeIndex}][image]" class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 property-type-image-input" placeholder="image.jpg">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Floor Plan Filename</label>
                            <input type="text" name="propertyTypes[${propertyTypeIndex}][floor_plan]" class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 property-type-floorplan-input" placeholder="floorplan.jpg">
                        </div>
                    </div>
                </div>
                <div class="flex-shrink-0">
                    <button type="button" onclick="removePropertyType(this)" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors" title="Remove this property type">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
        `;
        container.appendChild(newItem);
        propertyTypeIndex++;
    }

    function removePropertyType(btn) {
        const item = btn.closest('.property-type-item');
        item.remove();
        checkEmptyPropertyTypes();
    }

    function deletePropertyType(btn, id) {
        if (!confirm('Are you sure you want to delete this property type?')) return;

        const item = btn.closest('.property-type-item');

        // Send delete request
        fetch(`/projects/property-types/${id}`, {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => {
            if (response.ok) {
                item.remove();
                checkEmptyPropertyTypes();
            } else {
                alert('Failed to delete property type');
            }
        })
        .catch(err => {
            console.error('Error:', err);
            alert('Error deleting property type');
        });
    }

    function checkEmptyPropertyTypes() {
        const container = document.getElementById('property-types-container');
        const noTypesMsg = document.getElementById('no-property-types');
        if (container.children.length === 0 && noTypesMsg) {
            noTypesMsg.style.display = 'block';
        }
    }

    // Upload property type image
    function uploadPropertyTypeImage(input) {
        const file = input.files[0];
        if (!file) return;

        const propertyTypeId = input.dataset.id;
        const imageType = input.dataset.type; // 'image' or 'floor_plan'
        const container = input.closest('.property-type-item') || input.closest('.relative').parentElement;

        // Show loading state
        const previewEl = input.parentElement.querySelector('img, div');
        const originalContent = previewEl.outerHTML;
        previewEl.outerHTML = '<div class="w-full h-20 bg-gray-300 rounded flex items-center justify-center animate-pulse"><span class="text-xs text-gray-600">Uploading...</span></div>';

        const formData = new FormData();
        formData.append('file', file);
        formData.append('propertyTypeId', propertyTypeId);
        formData.append('imageType', imageType);

        fetch('/projects/property-types/upload', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update the preview with new image (use fullUrl from response for new uploads)
                const newPreview = input.parentElement.querySelector('div, img');
                const imageUrl = data.fullUrl || (IMAGE_BASE_URL + data.filename);
                newPreview.outerHTML = `<img src="${imageUrl}" alt="Uploaded" class="w-full h-20 ${imageType === 'image' ? 'object-cover' : 'object-contain bg-white'} rounded border border-gray-200">`;

                // Update the hidden input if exists - store full URL for new uploads
                const hiddenInput = container.querySelector(`input[name*="[${imageType}]"]`);
                if (hiddenInput) {
                    hiddenInput.value = data.fullUrl || data.filename;
                }

                // Show success message
                showToast('Image uploaded successfully!', 'success');
            } else {
                // Restore original preview
                const loadingEl = input.parentElement.querySelector('div');
                loadingEl.outerHTML = originalContent;
                showToast('Failed to upload image: ' + (data.error || 'Unknown error'), 'error');
            }
        })
        .catch(err => {
            console.error('Upload error:', err);
            const loadingEl = input.parentElement.querySelector('div');
            if (loadingEl) {
                loadingEl.outerHTML = originalContent;
            }
            showToast('Error uploading image', 'error');
        });

        // Reset the file input
        input.value = '';
    }

    // Toast notification helper
    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `fixed bottom-4 right-4 px-4 py-2 rounded-lg text-white text-sm z-50 ${
            type === 'success' ? 'bg-green-600' :
            type === 'error' ? 'bg-red-600' : 'bg-blue-600'
        }`;
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }
</script>
